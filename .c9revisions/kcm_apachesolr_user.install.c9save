{"ts":1348584680726,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\n// $Id$\n\n/**\n * @file\n *   Install and related hooks for apachesolr_indexer_user.\n */\n\n/**\n * Implements hook_schema().\n */\nfunction kcm_apachesolr_user_schema() {\n  $types = array(\n      'user' => 'kcm_apachesolr_index_entities_user',\n  );\n  foreach ($types as $type) {\n    $schema[$type] = array(\n      'description' => t('Stores a record of when an entity changed to determine if it needs indexing by Solr.'),\n      'fields' => array(\n        'entity_type' => array(\n          'description' => t('The type of entity.'),\n          'type' => 'varchar',\n          'length' => 128,\n          'not null' => TRUE,\n        ),\n        'entity_id' => array(\n          'description' => t('The primary identifier for an entity.'),\n          'type' => 'int',\n          'unsigned' => TRUE,\n          'not null' => TRUE,\n        ),\n        'bundle' => array(\n          'description' => t('The bundle to which this entity belongs.'),\n          'type' => 'varchar',\n          'length' => 128,\n          'not null' => TRUE,\n        ),\n        'status' => array(\n          'description' => t('Boolean indicating whether the entity is visible to non-administrators (eg, published for nodes).'),\n          'type' => 'int',\n          'not null' => TRUE,\n          'default' => 1,\n        ),\n        'changed' => array(\n          'description' => t('The Unix timestamp when an entity was changed.'),\n          'type' => 'int',\n          'not null' => TRUE,\n          'default' => 0,\n        ),\n      ),\n      'indexes' => array(\n        'changed' => array('changed', 'status'),\n      ),\n      'primary key' => array('entity_id'),\n    );\n  }\n  return $schema;\n}\n\n/**\n * Implements hook_enable().\n */\nfunction kcm_apachesolr_user_enable() {\n  // Make sure the default core search page is installed.\n  $search_page = apachesolr_search_page_load('kcm_user_search');\n  if (empty($search_page)) {\n    // Add Default search page (core search)\n    // This is a duplication from update_7004 but it is intended\n    // so future changes are possible without breaking the update\n    $settings = array(\n      'fq' => array('entity_type:user'),\n      'kcm_apachesolr_search_custom_enable' => TRUE,\n      'kcm_apachesolr_search_search_type' => 'custom',\n      'kcm_apachesolr_search_per_page' => 10,\n      'kcm_apachesolr_search_browse' => 'browse',\n      'kcm_apachesolr_search_spellcheck' => TRUE,\n      'kcm_apachesolr_search_search_box' => TRUE,\n    );\n    $settings = serialize($settings);\n\n    $fields = array(\n      'page_id' => 'kcm_user_search',\n      'label' => 'KCM User Search',\n      'description' => 'KCM User Search',\n      'search_path' => 'search/kcm-user',\n      'env_id' => 'solr',\n      'page_title' => 'KCM User Search',\n      'settings' => $settings,\n    );\n    db_insert('kcm_apachesolr_search_page')->fields($fields)->execute();\n  }\n\n\n  $active = variable_get('search_active_modules', array('node', 'user'));\n  $active[] = 'apachesolr_search';\n  variable_set('search_active_modules', array_unique($active));\n}\n"]],"start1":0,"start2":0,"length1":0,"length2":3006}]],"length":3006}
